#!/bin/bash

# Fix common errors:
# Referencing undefined variables (which default to "")
# Ignoring failing commands
set -o nounset
set -o errexit
set -o pipefail
# Note this breaks passing a variable as args to a command
IFS=$'\n\t'

source ~/.config/jira_issue.sh

COMMAND=$(basename $0)

case $COMMAND in
    jira_transition)
        echo her
    ;;
    jira_create)
        SUMMARY=${1:-}
        DESC=${2:-TODO}

        if [[ -z $SUMMARY ]]; then
            echo "Usage:"
            echo "$0 'Summary' 'Description'"
            exit 1
        fi

        DATA=$(printf '{"fields":{"project":{"key": "%s"},"summary": "%s","description": "%s","issuetype": {"name": "Task"}}}' "$PROJECT_KEY" "$SUMMARY" "$DESC")

        curl -u "${JIRA_USER}:${JIRA_PASSWORD}" -X POST --data $DATA -H "Content-Type: application/json" https://${JIRA_HOST}.atlassian.net/rest/api/2/issue/ | jq .
        ;;
esac
