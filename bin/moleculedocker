#!/bin/bash

DOCKER_IMAGE=tv2-devops-docker-production.jfrog.io/molecule:2.20

docker pull $DOCKER_IMAGE
docker pull tv2-devops-docker-production.jfrog.io/ansible-molecule-debian-9-systemd:latest
docker pull tv2-devops-docker-production.jfrog.io/ansible-molecule-centos-7.3-systemd:latest

docker run --rm --name molecule -it \
    -v "$(pwd)":/tmp/$(basename "$(pwd)") \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v molecule-state-$(basename "$(pwd)"):/tmp/molecule/ \
    -w /tmp/$(basename "$(pwd)") \
    $DOCKER_IMAGE \
    molecule $*

if [[ $* == 'destroy' ]]; then
    docker volume rm molecule-state-$(basename "$(pwd)")
fi
